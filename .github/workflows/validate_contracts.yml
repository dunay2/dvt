name: Validate Contracts (JSON Schema)

on:
  pull_request:
  push:
    paths:
      - 'docs/architecture/engine/contracts/**'
      - 'engine/src/contracts/**'

jobs:
  validate-schemas:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: Validate JSON schemas
        run: |
          set -e
          # Install ajv-cli temporarily
          npm install -g ajv@8 ajv-cli
          shopt -s nullglob
          files=(docs/architecture/engine/contracts/**/*.schema.json)
          if [ ${#files[@]} -eq 0 ]; then
            echo "No schema files found in docs/architecture/engine/contracts/ â€” skipping"
            exit 0
          fi
          for f in "${files[@]}"; do
            echo "Validating $f"
            # ajv compile will exit non-zero if schema is invalid
            npx ajv compile -s "$f"
          done
