import {
  DbtNode,
  DbtEdge,
  ExecutionPlan,
  Run,
  Plugin,
  Role,
  AuditLogEntry,
  DiffChange,
} from '../types/dbt';

export const mockNodes: DbtNode[] = [
  {
    id: 'src_erp_orders',
    name: 'src_erp_orders',
    type: 'SOURCE',
    package: 'raw_data',
    path: 'models/sources/erp.yml',
    tags: ['source', 'erp'],
    status: 'success',
    description: 'ERP orders source table',
    dependencies: [],
    columns: [
      { name: 'order_id', type: 'INTEGER', nullable: false },
      { name: 'customer_id', type: 'INTEGER', nullable: false },
      { name: 'order_date', type: 'DATE', nullable: false },
      { name: 'total_amount', type: 'DECIMAL', nullable: true },
    ],
  },
  {
    id: 'src_erp_customers',
    name: 'src_erp_customers',
    type: 'SOURCE',
    package: 'raw_data',
    path: 'models/sources/erp.yml',
    tags: ['source', 'erp'],
    status: 'success',
    description: 'ERP customers source table',
    dependencies: [],
    columns: [
      { name: 'customer_id', type: 'INTEGER', nullable: false },
      { name: 'customer_name', type: 'VARCHAR', nullable: false },
      { name: 'email', type: 'VARCHAR', nullable: true },
    ],
  },
  {
    id: 'stg_orders',
    name: 'stg_orders',
    type: 'MODEL',
    package: 'staging',
    path: 'models/staging/stg_orders.sql',
    tags: ['staging'],
    status: 'success',
    lastDuration: 2.3,
    lastCost: 0.05,
    description: 'Staging layer for orders',
    dependencies: ['src_erp_orders'],
    compiledSql: `SELECT
  order_id,
  customer_id,
  order_date,
  total_amount
FROM {{ source('erp', 'orders') }}
WHERE order_date >= '2020-01-01'`,
    columns: [
      { name: 'order_id', type: 'INTEGER', nullable: false },
      { name: 'customer_id', type: 'INTEGER', nullable: false },
      { name: 'order_date', type: 'DATE', nullable: false },
      { name: 'total_amount', type: 'DECIMAL', nullable: true },
    ],
  },
  {
    id: 'stg_customers',
    name: 'stg_customers',
    type: 'MODEL',
    package: 'staging',
    path: 'models/staging/stg_customers.sql',
    tags: ['staging'],
    status: 'success',
    lastDuration: 1.8,
    lastCost: 0.03,
    description: 'Staging layer for customers',
    dependencies: ['src_erp_customers'],
    compiledSql: `SELECT
  customer_id,
  customer_name,
  email
FROM {{ source('erp', 'customers') }}`,
    columns: [
      { name: 'customer_id', type: 'INTEGER', nullable: false },
      { name: 'customer_name', type: 'VARCHAR', nullable: false },
      { name: 'email', type: 'VARCHAR', nullable: true },
    ],
  },
  {
    id: 'dim_store',
    name: 'dim_store',
    type: 'MODEL',
    package: 'marts',
    path: 'models/marts/dim_store.sql',
    tags: ['dimension', 'marts'],
    status: 'success',
    lastDuration: 3.5,
    lastCost: 0.08,
    description: 'Store dimension table',
    dependencies: [],
    compiledSql: `SELECT
  store_id,
  store_name,
  region,
  opened_date
FROM raw.stores`,
    columns: [
      { name: 'store_id', type: 'INTEGER', nullable: false },
      { name: 'store_name', type: 'VARCHAR', nullable: false },
      { name: 'region', type: 'VARCHAR', nullable: false },
      { name: 'opened_date', type: 'DATE', nullable: true },
    ],
  },
  {
    id: 'fct_sales',
    name: 'fct_sales',
    type: 'MODEL',
    package: 'marts',
    path: 'models/marts/fct_sales.sql',
    tags: ['fact', 'marts'],
    status: 'success',
    lastDuration: 15.2,
    lastCost: 0.45,
    description: 'Sales fact table',
    dependencies: ['stg_orders', 'stg_customers', 'dim_store'],
    compiledSql: `SELECT
  o.order_id,
  o.customer_id,
  o.order_date,
  s.store_id,
  o.total_amount
FROM {{ ref('stg_orders') }} o
LEFT JOIN {{ ref('dim_store') }} s
  ON o.store_id = s.store_id`,
    columns: [
      { name: 'order_id', type: 'INTEGER', nullable: false },
      { name: 'customer_id', type: 'INTEGER', nullable: false },
      { name: 'order_date', type: 'DATE', nullable: false },
      { name: 'store_id', type: 'INTEGER', nullable: true },
      { name: 'total_amount', type: 'DECIMAL', nullable: true },
    ],
  },
  {
    id: 'test_not_null_store_id',
    name: 'test_not_null_store_id',
    type: 'TEST',
    package: 'tests',
    path: 'tests/test_not_null_store_id.sql',
    tags: ['test'],
    status: 'success',
    lastDuration: 0.5,
    description: 'Test that store_id is not null',
    dependencies: ['dim_store'],
    compiledSql: `SELECT *
FROM {{ ref('dim_store') }}
WHERE store_id IS NULL`,
  },
  {
    id: 'test_unique_order_id',
    name: 'test_unique_order_id',
    type: 'TEST',
    package: 'tests',
    path: 'tests/test_unique_order_id.sql',
    tags: ['test'],
    status: 'failed',
    lastDuration: 0.8,
    description: 'Test that order_id is unique',
    dependencies: ['stg_orders'],
    compiledSql: `SELECT order_id, COUNT(*) as cnt
FROM {{ ref('stg_orders') }}
GROUP BY order_id
HAVING COUNT(*) > 1`,
  },
  {
    id: 'exposure_powerbi_sales',
    name: 'exposure_powerbi_sales',
    type: 'EXPOSURE',
    package: 'exposures',
    path: 'models/exposures/powerbi.yml',
    tags: ['exposure', 'powerbi'],
    status: 'idle',
    description: 'PowerBI Sales Dashboard',
    dependencies: ['fct_sales'],
  },
];

export const mockEdges: DbtEdge[] = [
  { id: 'e1', source: 'src_erp_orders', target: 'stg_orders', type: 'source' },
  { id: 'e2', source: 'src_erp_customers', target: 'stg_customers', type: 'source' },
  { id: 'e3', source: 'stg_orders', target: 'fct_sales', type: 'ref' },
  { id: 'e4', source: 'stg_customers', target: 'fct_sales', type: 'ref' },
  { id: 'e5', source: 'dim_store', target: 'fct_sales', type: 'ref' },
  { id: 'e6', source: 'dim_store', target: 'test_not_null_store_id', type: 'test' },
  { id: 'e7', source: 'stg_orders', target: 'test_unique_order_id', type: 'test' },
  { id: 'e8', source: 'fct_sales', target: 'exposure_powerbi_sales', type: 'exposure' },
];

export const mockExecutionPlan: ExecutionPlan = {
  planId: 'plan_abc123',
  planVersion: '1.0.0',
  generatedAt: '2026-02-13T10:30:00Z',
  adapter: 'snowflake',
  target: 'dev',
  capabilities: ['pause', 'resume', 'retry'],
  estimatedCost: 0.95,
  steps: [
    {
      id: 'step_compile',
      type: 'DBT_COMPILE',
      name: 'Compile Models',
      nodes: ['stg_orders', 'stg_customers', 'dim_store', 'fct_sales'],
      policies: {
        timeout: 300,
        concurrency: 4,
      },
    },
    {
      id: 'step_run',
      type: 'DBT_RUN',
      name: 'Run Models',
      nodes: ['stg_orders', 'stg_customers', 'dim_store', 'fct_sales'],
      policies: {
        retries: 2,
        timeout: 600,
        concurrency: 2,
        warehouse: 'COMPUTE_WH',
      },
    },
    {
      id: 'step_test',
      type: 'DBT_TEST',
      name: 'Run Tests',
      nodes: ['test_not_null_store_id', 'test_unique_order_id'],
      policies: {
        retries: 1,
        timeout: 300,
        concurrency: 4,
      },
    },
  ],
};

export const mockRun: Run = {
  runId: 'run_xyz789',
  planId: 'plan_abc123',
  status: 'running',
  environment: 'dev',
  gitSha: 'a3f2b91',
  startTime: '2026-02-13T10:35:00Z',
  steps: [
    {
      id: 'step_compile',
      type: 'DBT_COMPILE',
      name: 'Compile Models',
      nodes: ['stg_orders', 'stg_customers', 'dim_store', 'fct_sales'],
      policies: { timeout: 300, concurrency: 4 },
      status: 'success',
      duration: 12.5,
    },
    {
      id: 'step_run',
      type: 'DBT_RUN',
      name: 'Run Models',
      nodes: ['stg_orders', 'stg_customers', 'dim_store', 'fct_sales'],
      policies: { retries: 2, timeout: 600, concurrency: 2, warehouse: 'COMPUTE_WH' },
      status: 'running',
      duration: 8.2,
    },
    {
      id: 'step_test',
      type: 'DBT_TEST',
      name: 'Run Tests',
      nodes: ['test_not_null_store_id', 'test_unique_order_id'],
      policies: { retries: 1, timeout: 300, concurrency: 4 },
      status: 'idle',
    },
  ],
  events: [
    {
      id: 'evt1',
      timestamp: '2026-02-13T10:35:00Z',
      type: 'StepStarted',
      stepId: 'step_compile',
      message: 'Started compilation step',
    },
    {
      id: 'evt2',
      timestamp: '2026-02-13T10:35:12Z',
      type: 'StepCompleted',
      stepId: 'step_compile',
      message: 'Compilation completed successfully',
    },
    {
      id: 'evt3',
      timestamp: '2026-02-13T10:35:13Z',
      type: 'StepStarted',
      stepId: 'step_run',
      message: 'Started run step',
    },
    {
      id: 'evt4',
      timestamp: '2026-02-13T10:35:14Z',
      type: 'NodeStarted',
      nodeId: 'stg_orders',
      message: 'Running stg_orders',
    },
  ],
  artifacts: {
    manifest: '/artifacts/run_xyz789/manifest.json',
    runResults: '/artifacts/run_xyz789/run_results.json',
    catalog: '/artifacts/run_xyz789/catalog.json',
  },
};

export const mockPlugins: Plugin[] = [
  {
    id: 'plugin_dbt_cloud',
    name: 'dbt Cloud Integration',
    version: '2.1.0',
    description: 'Sync with dbt Cloud projects and jobs',
    capabilities: ['custom_nodes', 'cloud_sync'],
    enabled: true,
    permissions: ['read_artifacts', 'write_runs'],
  },
  {
    id: 'plugin_cost_optimizer',
    name: 'Cost Optimizer',
    version: '1.5.2',
    description: 'Analyze and optimize warehouse costs',
    capabilities: ['cost_policies', 'warehouse_optimizer'],
    enabled: true,
    permissions: ['read_runs', 'read_artifacts'],
  },
  {
    id: 'plugin_slack_notifier',
    name: 'Slack Notifier',
    version: '1.0.3',
    description: 'Send run notifications to Slack',
    capabilities: ['notifications'],
    enabled: false,
    permissions: ['read_runs'],
  },
];

export const mockRoles: Role[] = [
  {
    id: 'role_admin',
    name: 'Administrator',
    permissions: {
      canPlan: true,
      canRun: true,
      canEditEdges: true,
      canManagePlugins: true,
      canManageRBAC: true,
    },
    scope: {},
  },
  {
    id: 'role_developer',
    name: 'Developer',
    permissions: {
      canPlan: true,
      canRun: true,
      canEditEdges: true,
      canManagePlugins: false,
      canManageRBAC: false,
    },
    scope: { environment: 'dev' },
  },
  {
    id: 'role_analyst',
    name: 'Analyst',
    permissions: {
      canPlan: true,
      canRun: false,
      canEditEdges: false,
      canManagePlugins: false,
      canManageRBAC: false,
    },
    scope: {},
  },
];

export const mockAuditLog: AuditLogEntry[] = [
  {
    id: 'audit1',
    timestamp: '2026-02-13T09:15:23Z',
    user: 'john.doe@company.com',
    action: 'RUN_STARTED',
    resource: 'run_xyz789',
    details: 'Started run with plan_abc123 in dev environment',
    status: 'success',
  },
  {
    id: 'audit2',
    timestamp: '2026-02-13T08:45:10Z',
    user: 'jane.smith@company.com',
    action: 'PLAN_CREATED',
    resource: 'plan_abc123',
    details: 'Created execution plan for selected nodes',
    status: 'success',
  },
  {
    id: 'audit3',
    timestamp: '2026-02-13T08:30:05Z',
    user: 'bob.wilson@company.com',
    action: 'EDGE_CREATED',
    resource: 'edge_e8',
    details: 'Added ref() dependency: fct_sales -> exposure_powerbi_sales',
    status: 'success',
  },
  {
    id: 'audit4',
    timestamp: '2026-02-13T08:00:12Z',
    user: 'alice.brown@company.com',
    action: 'PLUGIN_ENABLED',
    resource: 'plugin_cost_optimizer',
    details: 'Enabled Cost Optimizer plugin v1.5.2',
    status: 'success',
  },
];

export const mockDiffChanges: DiffChange[] = [
  {
    id: 'diff1',
    nodeId: 'fct_sales',
    type: 'changed',
    severity: 'breaking',
    description: 'Column type changed: total_amount DECIMAL -> NUMERIC(18,2)',
    oldValue: 'DECIMAL',
    newValue: 'NUMERIC(18,2)',
  },
  {
    id: 'diff2',
    nodeId: 'stg_orders',
    type: 'changed',
    severity: 'info',
    description: 'Added WHERE clause filter',
    oldValue: 'No filter',
    newValue: "WHERE order_date >= '2020-01-01'",
  },
  {
    id: 'diff3',
    nodeId: 'dim_customer',
    type: 'added',
    severity: 'info',
    description: 'New dimension table added',
  },
  {
    id: 'diff4',
    nodeId: 'fct_sales',
    type: 'changed',
    severity: 'breaking',
    description: 'Column removed: discount_amount',
    oldValue: 'discount_amount DECIMAL',
    newValue: null,
  },
];
